# [LeetCode] 380. Insert Delete GetRandom O(1)(Medium)

- **Link:** [LeetCode Problem Link](https://leetcode.com/problems/insert-delete-getrandom-o1/description/?envType=study-plan-v2&envId=top-interview-150)
- **Tags:** `Array`, `Hash Table`, `Math`, `Design`, `Randomized`
- **Difficulty:** Medium

## é¡Œç›®è§£é‡‹
è¨­è¨ˆä¸€å€‹è³‡æ–™çµæ§‹ï¼Œä½¿å¾—ä»¥ä¸‹ä¸‰å€‹æ“ä½œåŒæ™‚æ»¿è¶³å¹³å‡ $O(1)$ çš„æ™‚é–“è¤‡é›œåº¦:
1. `insert(val)`: æ’å…¥æ•¸å€¼ï¼ˆè‹¥ä¸å­˜åœ¨ï¼‰ã€‚
2. `remove(val)`: ç§»é™¤æ•¸å€¼ï¼ˆè‹¥å­˜åœ¨ï¼‰ã€‚
3. `getRandom()`: éš¨æ©Ÿå›å‚³ä¸€å€‹ç¾æœ‰çš„æ•¸å€¼ï¼ˆæ¯å€‹æ•¸å€¼è¢«é¸ä¸­çš„æ©Ÿç‡éœ€ç›¸ç­‰ï¼‰ã€‚


**é›£é»åˆ†æ**

* å–®ä¸€è³‡æ–™çµæ§‹ç„¡æ³•åŒæ™‚æ»¿è¶³éœ€æ±‚ï¼š
    * **Array ( `vector` )**ï¼šæ“…é•· `getRandom` (é€é Index å­˜å–æ˜¯ $O(1)$ )ï¼Œä½†**åˆªé™¤**ä¸­é–“å…ƒç´ æ™‚éœ€è¦æ¬ç§»è³‡æ–™ï¼Œè¤‡é›œåº¦æ˜¯ $O(N)$ã€‚
    * **Hash Map ( `unordered_map` )**ï¼šæ“…é•· `insert` èˆ‡ `remove` ($O(1)$ æŸ¥æ‰¾)ï¼Œä½†ç„¡æ³•æ”¯æ´ $O(1)$ çš„**éš¨æ©Ÿå­˜å–** (å› ç‚ºç¼ºä¹é€£çºŒç´¢å¼•)ã€‚

## è§£æ³•æ€è·¯


### è§£æ³•ï¼šåŒæ™‚ç¶­è­· Array å’Œ Hash Map
> [!IMPORTANT]
> **æ€è·¯ï¼š**
> 1. **Array çš„ç“¶é ¸**ï¼šåœ¨åˆªé™¤ä¸­é–“å…ƒç´ æ™‚ï¼Œç‚ºäº†ä¿æŒé€£çºŒæ€§ï¼Œé€šå¸¸éœ€è¦æ¬ç§»è³‡æ–™ï¼ˆ$O(N)$ï¼‰ã€‚
> 2. **è§£æ±ºæ–¹æ¡ˆ (Swap & Pop)**ï¼šå°‡ã€Œè¦åˆªé™¤çš„å…ƒç´ ã€èˆ‡ã€Œæœ€å¾Œä¸€å€‹å…ƒç´ ã€äº¤æ›ï¼Œå†ç§»é™¤æœ€å¾Œä¸€å€‹å…ƒç´ ï¼Œé”æˆ $O(1)$ åˆªé™¤ã€‚
> 3. **Hash Map çš„å¿…è¦æ€§**ï¼šç‚ºäº†åŸ·è¡Œäº¤æ›ï¼Œæˆ‘å€‘å¿…é ˆåœ¨ $O(1)$ æ™‚é–“å…§çŸ¥é“ **ã€ŒæŸå€‹æ•¸å€¼åœ¨ Array ä¸­çš„ Index æ˜¯å¤šå°‘ã€**ã€‚Array åªèƒ½å¾indexç›´æ¥æ‰¾åˆ°valueï¼Œç„¡æ³•ç›´æ¥å¾valueæ‰¾åˆ°indexï¼Œå› æ­¤éœ€è¦ Hash Map ä¾†è¨˜éŒ„ `Value -> Index` çš„å°æ˜ é—œä¿‚ã€‚


## è¤‡é›œåº¦åˆ†æ (Complexity Analysis)

| æ“ä½œ | æ™‚é–“è¤‡é›œåº¦ | èªªæ˜ |
| :--- | :--- | :--- |
| `insert(val)` | $O(1)$ | Hash Map æŸ¥æ‰¾ + Vector å°¾ç«¯æ’å…¥ |
| `remove(val)` | $O(1)$ | Hash Map æŸ¥æ‰¾ + Swap & Pop æ“ä½œ |
| `getRandom()` | $O(1)$ | ç›´æ¥é€é Vector Index å­˜å– (`nums[rand() % size]`) |

**ç©ºé–“è¤‡é›œåº¦ (Space Complexity)**ï¼š$O(N)$
* éœ€åŒæ™‚ç¶­è­· `vector` èˆ‡ `unordered_map`ï¼Œå…©è€…çš†å„²å­˜ $N$ å€‹å…ƒç´ ã€‚

> [!NOTE]
> ### ğŸ’¡ æ·±å…¥æ¢è¨ï¼šæ˜¯çœŸçš„ $O(1)$ å—ï¼Ÿ(Amortized vs. Strict)
> åš´æ ¼ä¾†èªªï¼Œæ¨™æº–åº«çš„ `push_back` åƒ…æ˜¯ **å‡æ”¤ (Amortized) $O(1)$**ï¼Œè€Œé **åš´æ ¼ (Strict) $O(1)$**ã€‚
>
> 1.  **Vector çš„æ“´å®¹æ©Ÿåˆ¶**ï¼š
>     * ç•¶ `vector` å®¹é‡æ»¿æ™‚ï¼Œ`push_back` æœƒè§¸ç™¼æ“´å®¹ï¼ˆé€šå¸¸æ˜¯ 2 å€ï¼‰ï¼Œé€™æ™‚éœ€è¦é‡æ–°åˆ†é…è¨˜æ†¶é«”ä¸¦è¤‡è£½æ‰€æœ‰å…ƒç´ ï¼Œè©²æ¬¡æ“ä½œè€—æ™‚ $O(N)$ã€‚
>     * ä½†åœ¨æœ¬é¡Œä¸­ï¼Œæˆ‘å€‘åœ¨å»ºæ§‹å¼ä¸­ä½¿ç”¨ **`nums.reserve(200000)`** é å…ˆåˆ†é…è¶³å¤ çš„è¨˜æ†¶é«”ï¼Œé¿å…äº†æ“´å®¹ç™¼ç”Ÿï¼Œä½¿ `insert` åœ¨æ­¤é¡Œç›®é™åˆ¶ä¸‹æˆç‚º **åš´æ ¼ $O(1)$**ã€‚
>
> 2.  **Hash Map çš„ç¢°æ’ (Collision)**ï¼š
>     * `unordered_map` çš„ $O(1)$ æ˜¯æŒ‡ **å¹³å‡æƒ…æ³ (Average Case)**ã€‚
>     * åœ¨æ¥µç«¯ç¢°æ’ä¸‹ï¼ˆæ‰€æœ‰ Key Hash åˆ°åŒä¸€å€‹ Bucketï¼‰ï¼ŒæŸ¥æ‰¾æœƒé€€åŒ–æˆ Linked List çš„éæ­·ï¼Œè®Šç‚º $O(N)$ã€‚ä½†åœ¨æ­£å¸¸éš¨æ©Ÿæ•¸æ“šä¸‹ï¼Œå¯è¦–ç‚º $O(1)$ã€‚


```cpp
class RandomizedSet {

private:
    // Dynamic Array: ç”¨ä¾†å­˜å¯¦éš›æ•¸å€¼ï¼Œæ”¯æ´ O(1) çš„éš¨æ©Ÿå­˜å– (é€é index)
    vector<int> nums;
    
    // Hash Map: ç”¨ä¾†å­˜ {æ•¸å€¼ : ç´¢å¼•}ï¼Œæ”¯æ´ O(1) çš„æŸ¥æ‰¾ (çŸ¥é“æ•¸å€¼åœ¨å“ªè£¡)
    unordered_map<int, int> val_to_index;

public:
    RandomizedSet() {
        // å„ªåŒ–ï¼šé å…ˆä¿ç•™è¨˜æ†¶é«”ç©ºé–“ï¼Œé¿å… vector åœ¨ push_back æ™‚é »ç¹æ“´å®¹ (Reallocate)
        // é€™èƒ½è®“ insert æ“ä½œå¾ã€Œå‡æ”¤ O(1)ã€è®Šæˆã€Œåš´æ ¼ O(1)ã€
        nums.reserve(200000);
    }
    
    bool insert(int val) {
        // 1. æª¢æŸ¥æ˜¯å¦å­˜åœ¨ï¼šå¦‚æœ map è£¡å·²ç¶“æœ‰é€™å€‹ keyï¼Œä»£è¡¨é‡è¤‡äº†ï¼Œå›å‚³ false
        if(val_to_index.count(val)){
            return false;
        }
        
        // 2. åŠ å…¥ Arrayï¼šæŠŠæ–°æ•¸å­—æ”¾åˆ°é™£åˆ—æœ€å¾Œé¢ (O(1))
        nums.push_back(val);
        // ä¸èƒ½ç›´æ¥å¯« nums[size] = valï¼Œå› ç‚º vector éœ€è¦ push_back æ‰æœƒåˆ†é…æ–°ç©ºé–“
        
        // 3. æ›´æ–° Mapï¼šè¨˜éŒ„é€™å€‹æ•¸å€¼ç¾åœ¨ä½æ–¼ Array çš„å“ªå€‹ index
        // å› ç‚ºå‰› push_backï¼Œæ‰€ä»¥ index å°±æ˜¯ size - 1
        val_to_index[val] = nums.size() - 1; 
        
        return true;
    }
    
    bool remove(int val) {
        // 1. æª¢æŸ¥æ˜¯å¦å­˜åœ¨ï¼šå¦‚æœ map è£¡æ‰¾ä¸åˆ°ï¼Œä»£è¡¨æ²’æ±è¥¿å¯åˆªï¼Œå›å‚³ false
        if(val_to_index.count(val)){
            
            // æ­¥é©Ÿ A: å–å¾—è³‡è¨Š
            int index = val_to_index[val]; // è¦åˆªé™¤çš„ç›®æ¨™åœ¨å“ªå€‹ä½ç½®
            int last_val = nums.back();    // é™£åˆ—æœ€å¾Œä¸€å€‹å…ƒç´ æ˜¯èª° (ç”¨ä¾†è£œæ´)
            
            // æ­¥é©Ÿ B: Swap (ç”¨æœ€å¾Œä¸€å€‹å…ƒç´ è¦†è“‹æ‰è¦åˆªé™¤çš„å…ƒç´ )
            nums[index] = last_val;
            
            // æ­¥é©Ÿ C: Update Map (æ›´æ–°åŸæœ¬æœ€å¾Œä¸€å€‹å…ƒç´ çš„æ–°ä½ç½®)
            // é—œéµé †åº 1ï¼šå…ˆæŠŠ last_val çš„ä½ç½®æ”¹æˆ index
            val_to_index[last_val] = index;
            
            // æ­¥é©Ÿ D: Pop (ç§»é™¤é™£åˆ—æœ€å¾Œä¸€æ ¼)
            nums.pop_back();
            
            // æ­¥é©Ÿ E: Erase Map (ç§»é™¤ç›®æ¨™æ•¸å€¼çš„ç´€éŒ„)
            // é—œéµé †åº 2ï¼šé€™è¡Œè¦æ”¾åœ¨ Update ä¹‹å¾Œ
            // é€™æ¨£å¦‚æœã€Œè¦åˆªé™¤çš„ã€å‰›å¥½å°±æ˜¯ã€Œæœ€å¾Œä¸€å€‹ã€(val == last_val)ï¼Œ
            // Update æœƒå…ˆè¨­å®šä¸€æ¬¡ï¼Œç„¶å¾Œ Erase å†æŠŠå®ƒåˆªæ‰ï¼Œçµæœæ‰æ˜¯æ­£ç¢ºçš„ã€Œåˆªé™¤ã€ã€‚
            val_to_index.erase(val);

            return true;
        }
        return false;
    }
    
    int getRandom() {
        // åˆ©ç”¨ Array çš„ç‰¹æ€§ï¼Œéš¨æ©Ÿç”¢ç”Ÿä¸€å€‹ index ç›´æ¥è®€å–ï¼Œæ™‚é–“è¤‡é›œåº¦ O(1)
        return nums[rand() % nums.size()];
    }
};
```
